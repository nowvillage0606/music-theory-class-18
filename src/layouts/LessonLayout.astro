---
import "../styles/tailwind.css";

// Markdownページからは frontmatter と headings が渡ってくる
const { frontmatter, headings = [] } = Astro.props;

// h2/h3 のみ抽出してTOCを作成
const toc = headings
  .filter(h => h.depth === 2 || h.depth === 3)
  .map(h => ({ depth: h.depth, text: h.text, slug: h.slug }));
---
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{frontmatter?.title ?? "Lesson"}</title>
    <meta name="description" content={frontmatter?.summary ?? ""} />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL,GRAD,opsz@400,0,0,24&display=swap">
    <style>
        .ms { font-family: 'Material Symbols Outlined'; font-weight: 400; font-style: normal;
        font-size: 1.25em; line-height: 1; vertical-align: -2px; }
    </style>
  </head>
  <body class="bg-white text-slate-800">
    <!-- Hero -->
    <header class="border-b bg-gradient-to-b from-slate-50 to-white">
      <div class="mx-auto max-w-5xl px-4 py-10">
        <p class="text-sm text-slate-500">第18回 授業ページ</p>
        <h1 class="mt-2 text-3xl font-bold tracking-tight">{frontmatter?.title ?? "曲の雰囲気・大分解"}</h1>
        {frontmatter?.summary && (
          <p class="mt-3 max-w-3xl text-slate-600">{frontmatter.summary}</p>
        )}
      </div>
    </header>

    <main class="mx-auto max-w-5xl px-4 py-8 grid gap-8 lg:grid-cols-[240px_1fr]">
      <!-- TOC（PCはサイド、SPは上に表示） -->
      <aside class="lg:sticky lg:top-20 h-max">
        <nav class="text-sm">
          <p class="font-semibold text-slate-700 mb-2">目次</p>
          <ul class="space-y-1">
            {toc.map(({depth, text, slug}) => (
              <li class={depth === 2 ? "pl-0 font-medium" : "pl-4 text-slate-500"}>
                <a href={`#${slug}`} class="hover:text-slate-900">
                  {text}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      </aside>

      <!-- 本文 -->
      <article class="prose prose-lg prose-slate">
        <slot />
      </article>
    </main>

    <footer class="border-t mt-12">
      <div class="mx-auto max-w-5xl px-4 py-6 text-sm text-slate-500">
        © {new Date().getFullYear()} Music Planz
      </div>
    </footer>
  </body>
</html>
